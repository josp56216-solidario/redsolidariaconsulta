<!DOCTYPE html>
<html lang="es">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>Consulta Red Solidaria 2025</title>
    
    <!-- React & ReactDOM -->
    <script crossorigin src="https://unpkg.com/react@18/umd/react.production.min.js"></script>
    <script crossorigin src="https://unpkg.com/react-dom@18/umd/react-dom.production.min.js"></script>
    
    <!-- Babel para compilar JSX en el navegador -->
    <script src="https://unpkg.com/@babel/standalone/babel.min.js"></script>
    
    <!-- Tailwind CSS -->
    <script src="https://cdn.tailwindcss.com"></script>
    
    <!-- Fuente Inter (Opcional, para mejor estética) -->
    <link href="https://fonts.googleapis.com/css2?family=Inter:wght@300;400;500;600;700&display=swap" rel="stylesheet">

    <style>
        body { font-family: 'Inter', sans-serif; }
        
        /* Animaciones personalizadas */
        @keyframes fadeIn { from { opacity: 0; } to { opacity: 1; } }
        @keyframes slideUp { from { transform: translateY(20px); opacity: 0; } to { transform: translateY(0); opacity: 1; } }
        @keyframes pulseSlow { 0%, 100% { opacity: 0.5; } 50% { opacity: 0.8; } }
        @keyframes shake { 0%, 100% { transform: translateX(0); } 25% { transform: translateX(-5px); } 75% { transform: translateX(5px); } }
        
        .animate-in { animation: fadeIn 0.5s ease-out forwards; }
        .slide-in-from-bottom-4 { animation: slideUp 0.5s ease-out forwards; }
        .animate-pulse-slow { animation: pulseSlow 4s infinite; }
        .animate-shake { animation: shake 0.3s ease-in-out; }
        
        /* Utilidades extra */
        .glass-panel {
            background: rgba(255, 255, 255, 0.8);
            backdrop-filter: blur(12px);
            -webkit-backdrop-filter: blur(12px);
        }
    </style>
</head>
<body class="bg-slate-50 text-slate-800">
    <div id="root"></div>

    <script type="text/babel">
        const { useState, useEffect } = React;

        // --- ICONOS (SVG Inline para evitar dependencias externas) ---
        const IconBase = ({ children, size = 24, className = "" }) => (
            <svg xmlns="http://www.w3.org/2000/svg" width={size} height={size} viewBox="0 0 24 24" fill="none" stroke="currentColor" strokeWidth="2" strokeLinecap="round" strokeLinejoin="round" className={className}>
                {children}
            </svg>
        );

        const Search = (props) => <IconBase {...props}><circle cx="11" cy="11" r="8"/><path d="m21 21-4.3-4.3"/></IconBase>;
        const UserX = (props) => <IconBase {...props}><path d="M16 21v-2a4 4 0 0 0-4-4H6a4 4 0 0 0-4 4v2"/><circle cx="9" cy="7" r="4"/><line x1="17" x2="22" y1="8" y2="13"/><line x1="22" x2="17" y1="8" y2="13"/></IconBase>;
        const AlertCircle = (props) => <IconBase {...props}><circle cx="12" cy="12" r="10"/><line x1="12" x2="12" y1="8" y2="12"/><line x1="12" x2="12.01" y1="16" y2="16"/></IconBase>;
        const Database = (props) => <IconBase {...props}><ellipse cx="12" cy="5" rx="9" ry="3"/><path d="M3 5V19A9 3 0 0 0 21 19V5"/><path d="M3 12A9 3 0 0 0 21 12"/></IconBase>;
        const CheckCircle2 = (props) => <IconBase {...props}><circle cx="12" cy="12" r="10"/><path d="m9 12 2 2 4-4"/></IconBase>;
        const MapPin = (props) => <IconBase {...props}><path d="M20 10c0 6-8 12-8 12s-8-6-8-12a8 8 0 0 1 16 0Z"/><circle cx="12" cy="10" r="3"/></IconBase>;
        const CreditCard = (props) => <IconBase {...props}><rect width="20" height="14" x="2" y="5" rx="2"/><line x1="2" x2="22" y1="10" y2="10"/></IconBase>;
        const Loader2 = ({ className, size, ...props }) => <IconBase className={`animate-spin ${className}`} size={size} {...props}><path d="M21 12a9 9 0 1 1-6.219-8.56"/></IconBase>;
        const ArrowRight = (props) => <IconBase {...props}><path d="M5 12h14"/><path d="m12 5 7 7-7 7"/></IconBase>;
        const Lock = (props) => <IconBase {...props}><rect x="3" y="11" width="18" height="11" rx="2" ry="2"/><path d="M7 11V7a5 5 0 0 1 10 0v4"/></IconBase>;
        const LogOut = (props) => <IconBase {...props}><path d="M9 21H5a2 2 0 0 1-2-2V5a2 2 0 0 1 2-2h4"/><polyline points="16 17 21 12 16 7"/><line x1="21" x2="9" y1="12" y2="12"/></IconBase>;

        // --- SISTEMA DE ACCESO (Ofuscado) ---
        // Configuración interna de seguridad
        const _sys_chk_01 = [97, 100, 109, 105, 110]; // u
        const _sys_chk_02 = [76, 73, 66, 82, 69, 50, 48, 50, 53]; // p

        const _validate_access = (input, target) => {
            if (!input) return false;
            if (input.length !== target.length) return false;
            return input.split('').every((c, i) => c.charCodeAt(0) === target[i]);
        };

        // --- CONFIGURACIÓN ---
        const PRECONFIGURED_SHEET_URL = "https://docs.google.com/spreadsheets/d/e/2PACX-1vRUnJ7lDvotkp4Oj2MAG6Ka8D1QPmN5CDVU0UigA7utTCIC-PfgbHqgDnR6IH1gnwNB6aP8iWTv17KI/pub?output=csv";
        const FALLBACK_DATA = [{ no: "1", dep: "CORTES", mun: "San Pedro Sula", aldea: "COFRADIA", id: "0101195901659", nombre: "ROSSELL EDUARDO VALLE MATUTE" }];

        // --- COMPONENTE PRINCIPAL ---
        function App() {
          // Estados de autenticación
          const [isAuthenticated, setIsAuthenticated] = useState(false);
          const [loginUser, setLoginUser] = useState('');
          const [loginPass, setLoginPass] = useState('');
          const [loginError, setLoginError] = useState(false);

          // Estados de la app principal
          const [query, setQuery] = useState('');
          const [result, setResult] = useState(null);
          const [hasSearched, setHasSearched] = useState(false);
          const [loading, setLoading] = useState(false);
          const [isInitializing, setIsInitializing] = useState(true);
          const [database, setDatabase] = useState([]);
          const [dataStats, setDataStats] = useState({ loaded: 0, source: 'Conectando...' });

          const normalizeText = (text) => {
            if (text === null || text === undefined) return '';
            return text.toString().toLowerCase().normalize("NFD").replace(/[\u0300-\u036f]/g, "").trim();
          };

          // --- MANEJO DE LOGIN ---
          const handleLogin = (e) => {
              e.preventDefault();
              setLoginError(false);
              
              // Verificación ofuscada
              const isUserValid = _validate_access(loginUser, _sys_chk_01);
              const isPassValid = _validate_access(loginPass, _sys_chk_02);

              if (isUserValid && isPassValid) {
                  setIsAuthenticated(true);
              } else {
                  setLoginError(true);
                  setLoginPass('');
              }
          };

          const handleLogout = () => {
              setIsAuthenticated(false);
              setLoginUser('');
              setLoginPass('');
              setResult(null);
              setHasSearched(false);
              setQuery('');
          };

          // --- LÓGICA DE BÚSQUEDA ---
          const handleSearch = (e) => {
            e.preventDefault();
            if (!query.trim()) return;

            setLoading(true);
            setHasSearched(true);
            setResult(null);

            setTimeout(() => {
              const cleanQuery = normalizeText(query.replace(/-/g, '').replace(/\s+/g, ' '));
              const found = database.find(item => {
                const rawName = item.nombre || '';
                const rawId = item.id || '';
                const cleanName = normalizeText(rawName);
                const cleanId = normalizeText(rawId).replace(/[^a-z0-9]/g, '');
                return cleanId.includes(cleanQuery) || cleanName.includes(cleanQuery);
              });

              if (found) setResult(found);
              setLoading(false);
            }, 600);
          };

          // --- PARSEO CSV ---
          const parseCSVLine = (text) => {
            const result = [];
            let cell = '';
            let inQuotes = false;
            for (let i = 0; i < text.length; i++) {
              const char = text[i];
              if (char === '"') {
                if (inQuotes && text[i + 1] === '"') { cell += '"'; i++; } 
                else { inQuotes = !inQuotes; }
              } else if (char === ',' && !inQuotes) {
                result.push(cell.trim()); cell = '';
              } else { cell += char; }
            }
            result.push(cell.trim());
            return result;
          };

          const parseCSV = (text) => {
            const lines = text.split(/\r?\n/);
            if (lines.length < 2) return [];
            let headerRowIndex = -1;
            let headers = [];
            for (let i = 0; i < Math.min(lines.length, 30); i++) {
                const row = parseCSVLine(lines[i]).map(h => h.toLowerCase().replace(/[".]/g, '').trim());
                if (row.some(h => h.includes('identidad')) && row.some(h => h.includes('nombre'))) {
                    headerRowIndex = i; headers = row; break;
                }
            }
            if (headerRowIndex === -1) { headerRowIndex = 0; headers = parseCSVLine(lines[0]).map(h => h.toLowerCase().trim()); }
            const getIndex = (keyword) => headers.findIndex(h => h.includes(keyword));
            const idxId = getIndex('identidad'); const idxNombre = getIndex('nombre');
            const idxDep = getIndex('departamento'); const idxMun = getIndex('municipio');
            const idxAldea = getIndex('aldea'); const idxNo = getIndex('no');
            const parsedData = [];
            for(let i = headerRowIndex + 1; i < lines.length; i++) {
              if(!lines[i].trim()) continue;
              const row = parseCSVLine(lines[i]);
              if (row.length > Math.min(idxId, idxNombre)) {
                parsedData.push({
                  id: idxId !== -1 ? row[idxId] : '', nombre: idxNombre !== -1 ? row[idxNombre] : '',
                  dep: idxDep !== -1 ? row[idxDep] : '', mun: idxMun !== -1 ? row[idxMun] : '',
                  aldea: idxAldea !== -1 ? row[idxAldea] : '', no: idxNo !== -1 ? row[idxNo] : `${i}`
                });
              }
            }
            return parsedData;
          };

          const loadGoogleSheet = async () => {
            setLoading(true);
            try {
              const response = await fetch(PRECONFIGURED_SHEET_URL);
              if (!response.ok) throw new Error("Error de conexión");
              const text = await response.text();
              const newData = parseCSV(text);
              if (newData.length > 0) {
                setDatabase(newData);
                setDataStats({ loaded: newData.length, source: 'Base de Datos Oficial' });
              } else { throw new Error("Datos vacíos"); }
            } catch (err) {
              console.error(err);
              if (database.length === 0) setDatabase(FALLBACK_DATA); 
            } finally {
              setLoading(false);
              setIsInitializing(false);
            }
          };

          useEffect(() => { loadGoogleSheet(); }, []);

          // --- VISTA DE LOGIN ---
          if (!isAuthenticated) {
              return (
                <div className="min-h-screen bg-slate-50 font-sans text-slate-800 flex items-center justify-center p-4">
                    {/* Background Decorativo */}
                    <div className="fixed inset-0 z-0 pointer-events-none overflow-hidden">
                        <div className="absolute -top-[20%] -right-[10%] w-[700px] h-[700px] bg-blue-100 rounded-full blur-3xl opacity-50 mix-blend-multiply animate-pulse-slow"></div>
                        <div className="absolute -bottom-[20%] -left-[10%] w-[600px] h-[600px] bg-indigo-100 rounded-full blur-3xl opacity-50 mix-blend-multiply"></div>
                    </div>

                    <div className="relative z-10 w-full max-w-md bg-white/80 backdrop-blur-md p-8 rounded-3xl shadow-2xl border border-white/40 animate-in">
                        <div className="text-center mb-8">
                            <div className="w-16 h-16 bg-blue-600 rounded-2xl flex items-center justify-center mx-auto mb-4 shadow-lg shadow-blue-600/30">
                                <Lock className="text-white" size={32} />
                            </div>
                            <h2 className="text-2xl font-bold text-slate-900">Acceso Restringido</h2>
                            <p className="text-slate-500 text-sm mt-2">Sistema de Consulta Red Solidaria 2025</p>
                        </div>

                        <form onSubmit={handleLogin} className="space-y-4">
                            <div>
                                <label className="block text-xs font-bold text-slate-500 uppercase mb-1 ml-1">Usuario</label>
                                <input 
                                    type="text" 
                                    value={loginUser}
                                    onChange={(e) => setLoginUser(e.target.value)}
                                    className="w-full px-4 py-3 rounded-xl bg-slate-50 border border-slate-200 focus:border-blue-500 focus:ring-2 focus:ring-blue-200 outline-none transition-all"
                                    placeholder="Ingrese su usuario"
                                />
                            </div>
                            <div>
                                <label className="block text-xs font-bold text-slate-500 uppercase mb-1 ml-1">Contraseña</label>
                                <input 
                                    type="password" 
                                    value={loginPass}
                                    onChange={(e) => setLoginPass(e.target.value)}
                                    className="w-full px-4 py-3 rounded-xl bg-slate-50 border border-slate-200 focus:border-blue-500 focus:ring-2 focus:ring-blue-200 outline-none transition-all"
                                    placeholder="••••••••"
                                />
                            </div>

                            {loginError && (
                                <div className={`flex items-center gap-2 text-red-500 text-sm bg-red-50 p-3 rounded-lg border border-red-100 ${loginError ? 'animate-shake' : ''}`}>
                                    <AlertCircle size={16} />
                                    <span>Credenciales incorrectas</span>
                                </div>
                            )}

                            <button 
                                type="submit" 
                                className="w-full py-3.5 bg-blue-600 hover:bg-blue-700 text-white font-semibold rounded-xl shadow-lg shadow-blue-600/20 transition-all active:scale-95 mt-2"
                            >
                                Ingresar al Sistema
                            </button>
                        </form>
                        <p className="text-center text-xs text-slate-400 mt-6">
                            Solo personal autorizado
                        </p>
                    </div>
                </div>
              );
          }

          // --- VISTA PRINCIPAL (Si está autenticado) ---
          return (
            <div className="min-h-screen bg-slate-50 font-sans text-slate-800 selection:bg-blue-200">
              
              <div className="fixed inset-0 z-0 pointer-events-none overflow-hidden">
                <div className="absolute -top-[20%] -right-[10%] w-[700px] h-[700px] bg-blue-100 rounded-full blur-3xl opacity-50 mix-blend-multiply animate-pulse-slow"></div>
                <div className="absolute -bottom-[20%] -left-[10%] w-[600px] h-[600px] bg-indigo-100 rounded-full blur-3xl opacity-50 mix-blend-multiply"></div>
              </div>

              <header className="relative z-20 w-full pt-6 px-4">
                 <div className="container mx-auto max-w-5xl glass-panel rounded-2xl shadow-sm border border-white/20 p-4 flex justify-between items-center ring-1 ring-slate-900/5">
                    <div className="flex items-center gap-3">
                      <div className="bg-blue-600 text-white p-2.5 rounded-xl shadow-lg shadow-blue-600/20">
                        <Database size={24} />
                      </div>
                      <div>
                        <h1 className="font-bold text-lg leading-tight text-slate-900">Consulta Solidaria</h1>
                        <div className="flex items-center gap-2">
                           {isInitializing ? (
                             <span className="flex items-center gap-1 text-xs text-blue-600 font-medium animate-pulse">
                                <Loader2 size={10} className="animate-spin"/> Conectando BD...
                             </span>
                           ) : (
                             <>
                                <p className="text-xs font-medium text-slate-500 uppercase tracking-wide">
                                  {dataStats.source}
                                </p>
                                <span className={`text-[10px] px-2 py-0.5 rounded-full font-bold ${database.length > 1 ? 'bg-green-100 text-green-700' : 'bg-yellow-100 text-yellow-700'}`}>
                                  {database.length.toLocaleString()} registros
                                </span>
                             </>
                           )}
                        </div>
                      </div>
                    </div>
                    
                    <button 
                        onClick={handleLogout}
                        className="flex items-center gap-2 px-4 py-2 text-slate-500 hover:text-red-600 hover:bg-red-50 rounded-xl transition-all text-sm font-medium"
                        title="Cerrar Sesión"
                    >
                        <span className="hidden sm:inline">Salir</span>
                        <LogOut size={18} />
                    </button>
                 </div>
              </header>

              <main className="relative z-10 container mx-auto px-4 pt-10 md:pt-16 pb-20 flex flex-col items-center">
                
                <div className="w-full max-w-3xl text-center mb-10">
                  <h2 className="text-4xl md:text-5xl font-extrabold text-slate-900 tracking-tight mb-4">
                    Consulta de <span className="text-transparent bg-clip-text bg-gradient-to-r from-blue-600 to-indigo-600">Beneficiarios</span>
                  </h2>
                  <p className="text-lg text-slate-500 max-w-xl mx-auto leading-relaxed">
                    Sistema conectado al padrón oficial 2025. Busque por <strong>Identidad</strong> o <strong>Nombre</strong>.
                  </p>
                </div>

                <div className="w-full max-w-2xl relative group">
                  <div className="absolute -inset-1 bg-gradient-to-r from-blue-500 to-indigo-500 rounded-2xl blur opacity-20 group-hover:opacity-40 transition duration-500"></div>
                  <form onSubmit={handleSearch} className="relative bg-white rounded-2xl shadow-xl flex items-center p-2 ring-1 ring-slate-900/5">
                    <div className="pl-4 text-slate-400">
                      <Search size={24} />
                    </div>
                    <input
                      type="text"
                      className="w-full px-4 py-4 bg-transparent text-lg outline-none placeholder:text-slate-300 text-slate-700 font-medium disabled:opacity-50"
                      placeholder={isInitializing ? "Cargando base de datos..." : "Ej: 0101-1999-00223 o Juan Perez..."}
                      value={query}
                      onChange={(e) => {
                        setQuery(e.target.value);
                        if(hasSearched) setHasSearched(false);
                      }}
                      disabled={isInitializing}
                    />
                    <button 
                      type="submit"
                      disabled={loading || isInitializing}
                      className="bg-blue-600 text-white p-3.5 rounded-xl hover:bg-blue-700 transition-all shadow-md active:scale-95 disabled:opacity-70 disabled:scale-100"
                    >
                      {loading ? <Loader2 className="animate-spin" size={24} /> : <ArrowRight size={24} />}
                    </button>
                  </form>
                </div>

                <div className="w-full max-w-2xl mt-12 perspective-1000">
                  
                  {isInitializing && (
                     <div className="flex flex-col items-center justify-center p-8 animate-pulse text-slate-400">
                        <Loader2 size={40} className="animate-spin mb-4 text-blue-500"/>
                        <p>Estableciendo conexión segura con Google Sheets...</p>
                     </div>
                  )}

                  {hasSearched && result && !loading && (
                    <div className="bg-white rounded-3xl shadow-2xl shadow-blue-900/10 overflow-hidden ring-1 ring-slate-100 animate-in slide-in-from-bottom-4">
                      <div className="bg-gradient-to-r from-green-500 to-emerald-600 p-6 text-white flex items-center justify-between relative overflow-hidden">
                        <div className="relative z-10 flex items-center gap-4">
                          <div className="bg-white/20 p-3 rounded-2xl backdrop-blur-sm">
                            <CheckCircle2 size={32} className="text-white" />
                          </div>
                          <div>
                            <h3 className="font-bold text-xl">Registro Encontrado</h3>
                            <p className="text-green-100 text-sm opacity-90">Verificado en padrón oficial</p>
                          </div>
                        </div>
                        <div className="absolute top-0 right-0 -mt-4 -mr-4 w-32 h-32 bg-white/10 rounded-full blur-2xl"></div>
                      </div>

                      <div className="p-8">
                        <div className="mb-8">
                          <label className="text-xs font-bold text-slate-400 uppercase tracking-wider mb-1 block">Beneficiario</label>
                          <h4 className="text-2xl md:text-3xl font-bold text-slate-800 leading-tight">{result.nombre}</h4>
                        </div>

                        <div className="grid md:grid-cols-2 gap-6">
                          <div className="bg-slate-50 p-5 rounded-2xl border border-slate-100 hover:border-blue-100 transition-colors">
                            <div className="flex items-center gap-2 mb-2 text-blue-600">
                              <CreditCard size={18} />
                              <span className="text-xs font-bold uppercase tracking-wide">Identidad</span>
                            </div>
                            <p className="text-xl font-mono text-slate-700 font-semibold tracking-tight">{result.id}</p>
                          </div>

                          <div className="bg-slate-50 p-5 rounded-2xl border border-slate-100 hover:border-blue-100 transition-colors">
                            <div className="flex items-center gap-2 mb-2 text-blue-600">
                              <MapPin size={18} />
                              <span className="text-xs font-bold uppercase tracking-wide">Ubicación</span>
                            </div>
                            <p className="text-sm font-medium text-slate-600">
                              {result.aldea}
                              <br/>
                              <span className="text-slate-400">{result.mun}, {result.dep}</span>
                            </p>
                          </div>
                        </div>

                        <div className="mt-8 pt-6 border-t border-slate-100 flex justify-between items-center text-xs text-slate-400 font-medium">
                           <span>ID Registro: #{result.no}</span>
                           <span className="flex items-center gap-1"><div className="w-2 h-2 bg-green-500 rounded-full"></div> Activo</span>
                        </div>
                      </div>
                    </div>
                  )}

                  {hasSearched && !result && !loading && (
                    <div className="bg-white rounded-3xl shadow-xl border border-slate-100 p-10 flex flex-col items-center text-center animate-in zoom-in-95">
                      <div className="bg-red-50 p-5 rounded-full mb-6">
                        <UserX className="text-red-500" size={48} />
                      </div>
                      <h3 className="text-2xl font-bold text-slate-800 mb-3">No encontrado</h3>
                      <p className="text-slate-500 max-w-md mx-auto mb-8 leading-relaxed">
                        El criterio <strong>"{query}"</strong> no coincide con ningún registro en la base de datos cargada actualmente.
                      </p>
                      <div className="w-full bg-slate-50 rounded-xl p-4 text-left flex gap-3 border border-slate-100">
                         <AlertCircle className="text-slate-400 shrink-0 mt-0.5" size={18} />
                         <div className="text-sm text-slate-600">
                           <p className="font-semibold mb-1">¿Qué puede estar pasando?</p>
                           <ul className="list-disc list-inside space-y-1">
                             <li>Verifique el número de identidad.</li>
                             <li>Si el nombre tiene tildes raras, intente buscar solo por ID.</li>
                             <li>
                                Base de datos: <span className="font-medium text-blue-600">{database.length} registros cargados.</span>
                             </li>
                           </ul>
                         </div>
                      </div>
                    </div>
                  )}
                </div>
              </main>
            </div>
          );
        }

        const root = ReactDOM.createRoot(document.getElementById('root'));
        root.render(<App />);
    </script>
</body>
</html>
