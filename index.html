<!DOCTYPE html>
<html lang="es">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>Consulta Red Solidaria 2025 - Acceso Seguro</title>
    
    <!-- React & ReactDOM -->
    <script crossorigin src="https://unpkg.com/react@18/umd/react.production.min.js"></script>
    <script crossorigin src="https://unpkg.com/react-dom@18/umd/react-dom.production.min.js"></script>
    
    <!-- Babel -->
    <script src="https://unpkg.com/@babel/standalone/babel.min.js"></script>
    
    <!-- Tailwind CSS -->
    <script src="https://cdn.tailwindcss.com"></script>
    
    <!-- Fuente Inter -->
    <link href="https://fonts.googleapis.com/css2?family=Inter:wght@300;400;500;600;700&display=swap" rel="stylesheet">

    <style>
        body { font-family: 'Inter', sans-serif; }
        
        /* Animaciones */
        @keyframes fadeIn { from { opacity: 0; } to { opacity: 1; } }
        @keyframes slideUp { from { transform: translateY(20px); opacity: 0; } to { transform: translateY(0); opacity: 1; } }
        @keyframes pulseSlow { 0%, 100% { opacity: 0.5; } 50% { opacity: 0.8; } }
        @keyframes shake { 0%, 100% { transform: translateX(0); } 25% { transform: translateX(-5px); } 75% { transform: translateX(5px); } }
        
        .animate-in { animation: fadeIn 0.5s ease-out forwards; }
        .slide-in-from-bottom-4 { animation: slideUp 0.5s ease-out forwards; }
        .animate-pulse-slow { animation: pulseSlow 4s infinite; }
        .animate-shake { animation: shake 0.3s ease-in-out; }
        
        .glass-panel {
            background: rgba(255, 255, 255, 0.85);
            backdrop-filter: blur(16px);
            -webkit-backdrop-filter: blur(16px);
        }
        
        .security-pattern {
            background-color: #0f172a;
            background-image: radial-gradient(#1e293b 1px, transparent 1px);
            background-size: 20px 20px;
        }
    </style>
</head>
<body class="bg-slate-50 text-slate-800">
    <div id="root"></div>

    <script type="text/babel">
        const { useState, useEffect } = React;

        // --- ICONOS ---
        const IconBase = ({ children, size = 24, className = "" }) => (
            <svg xmlns="http://www.w3.org/2000/svg" width={size} height={size} viewBox="0 0 24 24" fill="none" stroke="currentColor" strokeWidth="2" strokeLinecap="round" strokeLinejoin="round" className={className}>{children}</svg>
        );
        const Search = (p) => <IconBase {...p}><circle cx="11" cy="11" r="8"/><path d="m21 21-4.3-4.3"/></IconBase>;
        const UserX = (p) => <IconBase {...p}><path d="M16 21v-2a4 4 0 0 0-4-4H6a4 4 0 0 0-4 4v2"/><circle cx="9" cy="7" r="4"/><line x1="17" x2="22" y1="8" y2="13"/><line x1="22" x2="17" y1="8" y2="13"/></IconBase>;
        const AlertCircle = (p) => <IconBase {...p}><circle cx="12" cy="12" r="10"/><line x1="12" x2="12" y1="8" y2="12"/><line x1="12" x2="12.01" y1="16" y2="16"/></IconBase>;
        const Database = (p) => <IconBase {...p}><ellipse cx="12" cy="5" rx="9" ry="3"/><path d="M3 5V19A9 3 0 0 0 21 19V5"/><path d="M3 12A9 3 0 0 0 21 12"/></IconBase>;
        const CheckCircle2 = (p) => <IconBase {...p}><circle cx="12" cy="12" r="10"/><path d="m9 12 2 2 4-4"/></IconBase>;
        const MapPin = (p) => <IconBase {...p}><path d="M20 10c0 6-8 12-8 12s-8-6-8-12a8 8 0 0 1 16 0Z"/><circle cx="12" cy="10" r="3"/></IconBase>;
        const CreditCard = (p) => <IconBase {...p}><rect width="20" height="14" x="2" y="5" rx="2"/><line x1="2" x2="22" y1="10" y2="10"/></IconBase>;
        const Loader2 = ({ className, size, ...p }) => <IconBase className={`animate-spin ${className}`} size={size} {...p}><path d="M21 12a9 9 0 1 1-6.219-8.56"/></IconBase>;
        const ArrowRight = (p) => <IconBase {...p}><path d="M5 12h14"/><path d="m12 5 7 7-7 7"/></IconBase>;
        const Lock = (p) => <IconBase {...p}><rect x="3" y="11" width="18" height="11" rx="2" ry="2"/><path d="M7 11V7a5 5 0 0 1 10 0v4"/></IconBase>;
        const LogOut = (p) => <IconBase {...p}><path d="M9 21H5a2 2 0 0 1-2-2V5a2 2 0 0 1 2-2h4"/><polyline points="16 17 21 12 16 7"/><line x1="21" x2="9" y1="12" y2="12"/></IconBase>;
        const ShieldAlert = (p) => <IconBase {...p}><path d="M12 22s8-4 8-10V5l-8-3-8 3v7c0 6 8 10 8 10z"/><line x1="12" x2="12" y1="8" y2="12"/><line x1="12" x2="12.01" y1="16" y2="16"/></IconBase>;
        const Key = (p) => <IconBase {...p}><path d="m21 2-2 2m-7.61 7.61a5.5 5.5 0 1 1-7.778 7.778 5.5 5.5 0 0 1 7.777-7.777zm0 0L15.5 7.5m0 0 3 3L22 7l-3-3m-3.5 3.5L19 4"/></IconBase>;
        const MessageCircle = (p) => <IconBase {...p}><path d="m3 21 1.9-5.7a8.5 8.5 0 1 1 3.8 3.8z"/></IconBase>;
        const Layers = (p) => <IconBase {...p}><polygon points="12 2 2 7 12 12 22 7 12 2"/><polyline points="2 17 12 22 22 17"/><polyline points="2 12 12 17 22 12"/></IconBase>;
        const List = (p) => <IconBase {...p}><line x1="8" x2="21" y1="6" y2="6"/><line x1="8" x2="21" y1="12" y2="12"/><line x1="8" x2="21" y1="18" y2="18"/><line x1="3" x2="3.01" y1="6" y2="6"/><line x1="3" x2="3.01" y1="12" y2="12"/><line x1="3" x2="3.01" y1="18" y2="18"/></IconBase>;
        const ArrowLeft = (p) => <IconBase {...p}><line x1="19" x2="5" y1="12" y2="12"/><polyline points="12 19 5 12 12 5"/></IconBase>;

        // --- SEGURIDAD AVANZADA (CRYPTO LOGIC) ---
        const ADMIN_PHONE = "50431960439";
        
        // Función simple de Hash
        const generateAccessKey = (deviceId) => {
            const salt = "RED_SOLIDARIA_SECURE_SALT_2025";
            let hash = 0;
            const str = deviceId + salt;
            for (let i = 0; i < str.length; i++) {
                const char = str.charCodeAt(i);
                hash = ((hash << 5) - hash) + char;
                hash = hash & hash;
            }
            return Math.abs(hash).toString(16).substring(0, 6).toUpperCase().padStart(6, 'X');
        };

        const getDeviceId = () => {
            let id = localStorage.getItem('rs_device_id');
            if (!id) {
                id = 'DEV-' + Math.floor(Math.random() * 9000 + 1000);
                localStorage.setItem('rs_device_id', id);
            }
            return id;
        };

        const getStoredKey = () => localStorage.getItem('rs_access_key');
        const setStoredKey = (key) => localStorage.setItem('rs_access_key', key);

        // Credenciales Admin Normal (admin / LIBRE2025)
        const _u_chk = [97, 100, 109, 105, 110];
        const _p_chk = [76, 73, 66, 82, 69, 50, 48, 50, 53];
        
        // Credenciales SUPER ADMIN (superadmin / jose504)
        const _su_chk = [115, 117, 112, 101, 114, 97, 100, 109, 105, 110]; // superadmin
        const _sp_chk = [106, 111, 115, 101, 53, 48, 52]; // jose504

        const validateStr = (input, target) => {
            if (!input || input.length !== target.length) return false;
            return input.split('').every((c, i) => c.charCodeAt(0) === target[i]);
        };

        // --- COMPONENTE PRINCIPAL ---
        function App() {
            // viewMode: 'login', 'blocked', 'app', 'superadmin_panel'
            const [viewMode, setViewMode] = useState('login'); 
            const [isSuperAdmin, setIsSuperAdmin] = useState(false); // Nuevo estado
            const [deviceId, setDeviceId] = useState('');
            const [inputKey, setInputKey] = useState('');
            const [ipAddress, setIpAddress] = useState('Detectando...');
            
            // Login
            const [loginUser, setLoginUser] = useState('');
            const [loginPass, setLoginPass] = useState('');
            const [loginError, setLoginError] = useState('');

            // App
            const [searchMode, setSearchMode] = useState('single');
            const [query, setQuery] = useState('');
            const [bulkQuery, setBulkQuery] = useState('');
            const [result, setResult] = useState(null);
            const [bulkResults, setBulkResults] = useState(null);
            const [hasSearched, setHasSearched] = useState(false);
            const [loading, setLoading] = useState(false);
            const [database, setDatabase] = useState([]);
            const [isInitializing, setIsInitializing] = useState(true);

            // Super Admin Panel
            const [targetDevice, setTargetDevice] = useState('');
            const [generatedKey, setGeneratedKey] = useState('');

            useEffect(() => {
                const id = getDeviceId();
                setDeviceId(id);
                fetch('https://api.ipify.org?format=json')
                    .then(res => res.json())
                    .then(data => setIpAddress(data.ip))
                    .catch(() => setIpAddress('IP Oculta'));
                
                loadGoogleSheet();
            }, []);

            // --- LÓGICA DE LOGIN Y SEGURIDAD ---
            const handleLoginSubmit = (e) => {
                e.preventDefault();
                setLoginError('');

                // 1. Verificar si es SUPER ADMIN
                if (validateStr(loginUser, _su_chk) && validateStr(loginPass, _sp_chk)) {
                    setIsSuperAdmin(true);
                    setViewMode('app'); // SUPERADMIN ENTRA DIRECTO A LA APP
                    return;
                }

                // 2. Verificar si es ADMIN NORMAL
                if (validateStr(loginUser, _u_chk) && validateStr(loginPass, _p_chk)) {
                    setIsSuperAdmin(false);
                    // Credenciales correctas. AHORA verificamos el dispositivo.
                    const storedKey = getStoredKey();
                    const validKey = generateAccessKey(deviceId);

                    if (storedKey === validKey) {
                        setViewMode('app');
                    } else {
                        // Dispositivo NO autorizado -> Bloquear
                        setViewMode('blocked');
                    }
                } else {
                    setLoginError('Credenciales inválidas');
                }
            };

            const handleUnlock = (e) => {
                e.preventDefault();
                const validKey = generateAccessKey(deviceId);
                if (inputKey.toUpperCase() === validKey) {
                    setStoredKey(validKey);
                    alert("Dispositivo autorizado exitosamente. Por favor ingrese sus credenciales.");
                    setViewMode('login');
                    setInputKey('');
                } else {
                    alert("Llave incorrecta. Contacte al SuperAdmin.");
                }
            };

            const sendWhatsAppRequest = () => {
                const msg = `Hola Admin. Nuevo dispositivo detectado.\nIP: ${ipAddress}\nCódigo: *${deviceId}*\nSolicito llave.`;
                window.open(`https://wa.me/${ADMIN_PHONE}?text=${encodeURIComponent(msg)}`, '_blank');
            };

            const generateKeyForUser = () => {
                if (!targetDevice) return;
                setGeneratedKey(generateAccessKey(targetDevice));
            };

            const sendKeyToUser = () => {
                const msg = `Acceso Aprobado.\nPara dispositivo: ${targetDevice}\nLlave: *${generatedKey}*`;
                window.open(`https://wa.me/?text=${encodeURIComponent(msg)}`, '_blank');
            };

            const handleLogout = () => {
                setIsSuperAdmin(false);
                setLoginUser('');
                setLoginPass('');
                setResult(null);
                setBulkResults(null);
                setHasSearched(false);
                setQuery('');
                setBulkQuery('');
                setViewMode('login');
            };

            // --- APP LOGIC ---
            const normalizeText = (text) => text?.toString().toLowerCase().normalize("NFD").replace(/[\u0300-\u036f]/g, "").trim() || '';

            const loadGoogleSheet = async () => {
                try {
                    const response = await fetch("https://docs.google.com/spreadsheets/d/e/2PACX-1vRUnJ7lDvotkp4Oj2MAG6Ka8D1QPmN5CDVU0UigA7utTCIC-PfgbHqgDnR6IH1gnwNB6aP8iWTv17KI/pub?output=csv");
                    if (!response.ok) throw new Error("Error red");
                    const text = await response.text();
                    const lines = text.split(/\r?\n/);
                    let headers = [], headerIdx = 0;
                    for(let i=0; i<Math.min(lines.length,30); i++){
                        if(lines[i].toLowerCase().includes('identidad')){ headerIdx=i; headers=lines[i].split(',').map(h=>h.replace(/"/g,'').trim().toLowerCase()); break; }
                    }
                    const idxId = headers.findIndex(h=>h.includes('identidad'));
                    const idxNom = headers.findIndex(h=>h.includes('nombre'));
                    const idxAld = headers.findIndex(h=>h.includes('aldea'));
                    
                    const data = [];
                    for(let i=headerIdx+1; i<lines.length; i++){
                        const row = lines[i].split(/,(?=(?:(?:[^"]*"){2})*[^"]*$)/);
                        if(row.length > idxId && row.length > idxNom){
                            data.push({
                                id: row[idxId]?.replace(/"/g,'').trim() || '',
                                nombre: row[idxNom]?.replace(/"/g,'').trim() || '',
                                aldea: idxAld > -1 ? row[idxAld]?.replace(/"/g,'').trim() : '',
                                no: i
                            });
                        }
                    }
                    setDatabase(data);
                } catch (e) { console.error(e); } finally { setIsInitializing(false); }
            };

            const handleSearch = (e) => {
                e.preventDefault();
                setLoading(true); setHasSearched(true); setResult(null);
                setTimeout(() => {
                    const q = normalizeText(query.replace(/-/g,''));
                    const found = database.find(i => normalizeText(i.id).replace(/[^a-z0-9]/g,'').includes(q) || normalizeText(i.nombre).includes(q));
                    setResult(found); setLoading(false);
                }, 500);
            };

            const handleBulkSearch = (e) => {
                e.preventDefault();
                setLoading(true); setHasSearched(true); setBulkResults(null);
                setTimeout(() => {
                    const qs = bulkQuery.split(/\r?\n/).filter(x=>x.trim());
                    const found = [], notFound = [];
                    qs.forEach(raw => {
                        const q = normalizeText(raw.replace(/-/g,''));
                        const match = database.find(i => normalizeText(i.id).replace(/[^a-z0-9]/g,'') === q || normalizeText(i.id).includes(q) || normalizeText(i.nombre) === q);
                        if(match) found.push({q:raw, data:match}); else notFound.push(raw);
                    });
                    setBulkResults({found, notFound}); setLoading(false);
                }, 800);
            };

            // --- VISTAS ---

            // 1. PANTALLA DE BLOQUEO
            if (viewMode === 'blocked') {
                return (
                    <div className="min-h-screen security-pattern font-sans text-slate-100 flex items-center justify-center p-4">
                        <div className="max-w-md w-full bg-slate-800/90 backdrop-blur-xl border border-red-500/30 p-8 rounded-3xl shadow-2xl relative overflow-hidden animate-in">
                            <div className="absolute top-0 left-0 w-full h-2 bg-gradient-to-r from-red-500 to-orange-500"></div>
                            
                            <div className="text-center mb-8">
                                <div className="w-20 h-20 bg-red-500/20 rounded-full flex items-center justify-center mx-auto mb-4 animate-pulse-slow">
                                    <ShieldAlert className="text-red-500" size={40} />
                                </div>
                                <h2 className="text-3xl font-bold text-white mb-2">Dispositivo No Registrado</h2>
                                <p className="text-slate-400 text-sm">Este dispositivo requiere autorización.</p>
                                <div className="mt-4 bg-slate-900/50 p-3 rounded-lg border border-slate-700 font-mono text-xs text-slate-400">
                                    IP DETECTADA: <span className="text-blue-400">{ipAddress}</span>
                                </div>
                            </div>

                            <div className="bg-slate-700/50 p-6 rounded-2xl border border-slate-600 mb-6 text-center">
                                <p className="text-xs uppercase tracking-widest text-slate-400 mb-2">Su Código de Dispositivo</p>
                                <div className="text-3xl font-mono font-bold text-white tracking-widest select-all bg-slate-800 p-2 rounded border border-slate-600 border-dashed">
                                    {deviceId}
                                </div>
                                <p className="text-[10px] text-slate-500 mt-2">Envíe este código al SuperAdmin.</p>
                            </div>

                            <button onClick={sendWhatsAppRequest} className="w-full py-4 bg-green-600 hover:bg-green-500 text-white font-bold rounded-xl flex items-center justify-center gap-2 mb-6 transition-all shadow-lg shadow-green-900/20">
                                <MessageCircle size={20} /> Solicitar Acceso por WhatsApp
                            </button>

                            <form onSubmit={handleUnlock} className="border-t border-slate-700 pt-6">
                                <label className="block text-xs font-bold text-slate-400 mb-2 uppercase">Ingresar Llave de Acceso:</label>
                                <div className="flex gap-2">
                                    <input type="text" value={inputKey} onChange={(e) => setInputKey(e.target.value.toUpperCase())} className="flex-1 bg-slate-900 border border-slate-600 rounded-xl px-4 py-3 text-white text-center font-mono placeholder:text-slate-600 focus:border-blue-500 outline-none tracking-widest uppercase" placeholder="XXXXXX" maxLength={6} />
                                    <button className="bg-blue-600 hover:bg-blue-500 text-white p-3 rounded-xl transition-colors"><ArrowRight /></button>
                                </div>
                            </form>
                            <button onClick={() => setViewMode('login')} className="w-full mt-4 text-slate-500 text-xs hover:text-white">Volver al Login</button>
                        </div>
                    </div>
                );
            }

            // 2. PANEL SUPER ADMIN (MODAL/VISTA DEDICADA PARA GENERAR LLAVES)
            if (viewMode === 'superadmin_panel') {
                return (
                    <div className="min-h-screen bg-slate-900 text-white font-sans p-6 flex flex-col items-center animate-in">
                        <div className="w-full max-w-2xl">
                            <header className="flex justify-between items-center mb-10 border-b border-slate-800 pb-4">
                                <div><h1 className="text-2xl font-bold text-transparent bg-clip-text bg-gradient-to-r from-purple-400 to-blue-400">Gestión de Accesos</h1><p className="text-xs text-slate-500">Zona SuperAdmin</p></div>
                                <button onClick={() => setViewMode('app')} className="text-sm bg-slate-800 hover:bg-slate-700 px-4 py-2 rounded-lg transition-colors flex items-center gap-2"><ArrowLeft size={16}/> Volver a la App</button>
                            </header>
                            <div className="bg-slate-800 p-8 rounded-3xl border border-slate-700 shadow-xl">
                                <h3 className="text-lg font-semibold mb-6 flex items-center gap-2"><Key className="text-yellow-400" /> Generar Llave de Acceso</h3>
                                <div className="space-y-4">
                                    <div>
                                        <label className="block text-xs text-slate-400 mb-1">CÓDIGO DEL DISPOSITIVO</label>
                                        <input type="text" value={targetDevice} onChange={(e) => { setTargetDevice(e.target.value.toUpperCase()); setGeneratedKey(''); }} className="w-full bg-slate-900 border border-slate-600 rounded-xl px-4 py-3 font-mono text-white focus:border-purple-500 outline-none uppercase" placeholder="EJ: DEV-1234" />
                                    </div>
                                    <button onClick={generateKeyForUser} className="w-full bg-purple-600 hover:bg-purple-500 py-3 rounded-xl font-bold transition-all">Generar Llave</button>
                                </div>
                                {generatedKey && (
                                    <div className="mt-8 bg-black/30 p-6 rounded-xl border border-green-500/30 text-center animate-in">
                                        <p className="text-xs text-green-400 mb-2">LLAVE GENERADA</p>
                                        <div className="text-4xl font-mono font-bold text-white tracking-[0.2em] mb-4 text-shadow-glow">{generatedKey}</div>
                                        <button onClick={sendKeyToUser} className="bg-green-600 text-sm px-6 py-2 rounded-full hover:bg-green-500 transition-colors flex items-center gap-2 mx-auto"><MessageCircle size={16}/> Enviar por WhatsApp</button>
                                    </div>
                                )}
                            </div>
                        </div>
                    </div>
                );
            }

            // 3. LOGIN
            if (viewMode === 'login') {
                return (
                    <div className="min-h-screen bg-slate-50 font-sans text-slate-800 flex items-center justify-center p-4">
                        <div className="fixed inset-0 z-0 pointer-events-none overflow-hidden">
                            <div className="absolute -top-[20%] -right-[10%] w-[700px] h-[700px] bg-blue-100 rounded-full blur-3xl opacity-50 mix-blend-multiply animate-pulse-slow"></div>
                            <div className="absolute -bottom-[20%] -left-[10%] w-[600px] h-[600px] bg-indigo-100 rounded-full blur-3xl opacity-50 mix-blend-multiply"></div>
                        </div>
                        <div className="relative z-10 w-full max-w-md bg-white/80 backdrop-blur-md p-8 rounded-3xl shadow-2xl border border-white/40 animate-in">
                            <div className="text-center mb-8">
                                <div className="w-16 h-16 bg-blue-600 rounded-2xl flex items-center justify-center mx-auto mb-4 shadow-lg shadow-blue-600/30"><Lock className="text-white" size={32} /></div>
                                <h2 className="text-2xl font-bold text-slate-900">Inicio de Sesión</h2>
                                <p className="text-slate-500 text-sm mt-2">Consulta Red Solidaria 2025</p>
                            </div>
                            <form onSubmit={handleLoginSubmit} className="space-y-4">
                                <div><label className="block text-xs font-bold text-slate-500 uppercase mb-1 ml-1">Usuario</label><input type="text" value={loginUser} onChange={(e) => setLoginUser(e.target.value)} className="w-full px-4 py-3 rounded-xl bg-slate-50 border border-slate-200 focus:border-blue-500 outline-none" placeholder="Usuario"/></div>
                                <div><label className="block text-xs font-bold text-slate-500 uppercase mb-1 ml-1">Contraseña</label><input type="password" value={loginPass} onChange={(e) => setLoginPass(e.target.value)} className="w-full px-4 py-3 rounded-xl bg-slate-50 border border-slate-200 focus:border-blue-500 outline-none" placeholder="••••••••"/></div>
                                {loginError && (<div className="flex items-center gap-2 text-red-500 text-sm bg-red-50 p-3 rounded-lg border border-red-100 animate-shake"><AlertCircle size={16} /><span>{loginError}</span></div>)}
                                <button type="submit" className="w-full py-3.5 bg-blue-600 hover:bg-blue-700 text-white font-semibold rounded-xl shadow-lg shadow-blue-600/20 transition-all active:scale-95 mt-2">Ingresar</button>
                            </form>
                        </div>
                    </div>
                );
            }

            // 4. APP PRINCIPAL
            return (
                <div className="min-h-screen bg-slate-50 font-sans text-slate-800 selection:bg-blue-200">
                    <div className="fixed inset-0 z-0 pointer-events-none overflow-hidden">
                        <div className="absolute -top-[20%] -right-[10%] w-[700px] h-[700px] bg-blue-100 rounded-full blur-3xl opacity-50 mix-blend-multiply animate-pulse-slow"></div>
                        <div className="absolute -bottom-[20%] -left-[10%] w-[600px] h-[600px] bg-indigo-100 rounded-full blur-3xl opacity-50 mix-blend-multiply"></div>
                    </div>

                    <header className="relative z-20 w-full pt-6 px-4">
                        <div className="container mx-auto max-w-5xl glass-panel rounded-2xl shadow-sm border border-white/20 p-4 flex justify-between items-center ring-1 ring-slate-900/5">
                            <div className="flex items-center gap-3">
                                <div className="bg-blue-600 text-white p-2.5 rounded-xl shadow-lg shadow-blue-600/20"><Database size={24} /></div>
                                <div>
                                    <h1 className="font-bold text-lg leading-tight text-slate-900">Consulta Solidaria</h1>
                                    <p className="text-[10px] text-slate-500 uppercase tracking-wide">
                                        {isInitializing ? 'Cargando BD...' : `${database.length.toLocaleString()} Registros`}
                                    </p>
                                </div>
                            </div>
                            <div className="flex items-center gap-2">
                                {/* BOTÓN EXCLUSIVO SUPER ADMIN */}
                                {isSuperAdmin && (
                                    <button 
                                        onClick={() => setViewMode('superadmin_panel')}
                                        className="flex items-center gap-2 px-4 py-2 bg-purple-100 text-purple-700 hover:bg-purple-200 rounded-xl transition-all text-sm font-bold border border-purple-200"
                                    >
                                        <Key size={18} /> Gestión de Accesos
                                    </button>
                                )}
                                
                                <button onClick={handleLogout} className="flex items-center gap-2 px-4 py-2 text-slate-500 hover:text-red-600 hover:bg-red-50 rounded-xl transition-all text-sm font-medium"><span className="hidden sm:inline">Salir</span><LogOut size={18} /></button>
                            </div>
                        </div>
                    </header>

                    <main className="relative z-10 container mx-auto px-4 pt-10 pb-20 flex flex-col items-center">
                        <div className="bg-white/50 p-1 rounded-xl flex gap-1 mb-8 shadow-sm border border-white/40">
                            <button onClick={() => {setSearchMode('single'); setHasSearched(false);}} className={`px-4 py-2 rounded-lg text-sm font-medium transition-all flex items-center gap-2 ${searchMode==='single'?'bg-white shadow text-blue-600':'text-slate-500'}`}><Search size={16}/> Individual</button>
                            <button onClick={() => {setSearchMode('bulk'); setHasSearched(false);}} className={`px-4 py-2 rounded-lg text-sm font-medium transition-all flex items-center gap-2 ${searchMode==='bulk'?'bg-white shadow text-blue-600':'text-slate-500'}`}><Layers size={16}/> Masiva</button>
                        </div>

                        <div className="w-full max-w-2xl relative group mb-12">
                            {searchMode === 'single' ? (
                                <form onSubmit={handleSearch} className="relative bg-white rounded-2xl shadow-xl flex items-center p-2 ring-1 ring-slate-900/5">
                                    <div className="pl-4 text-slate-400"><Search size={24} /></div>
                                    <input type="text" className="w-full px-4 py-4 bg-transparent text-lg outline-none placeholder:text-slate-300 text-slate-700 font-medium" placeholder="Identidad o Nombre..." value={query} onChange={(e) => setQuery(e.target.value)} />
                                    <button type="submit" disabled={loading} className="bg-blue-600 text-white p-3.5 rounded-xl hover:bg-blue-700 transition-all shadow-md">{loading ? <Loader2 className="animate-spin" size={24} /> : <ArrowRight size={24} />}</button>
                                </form>
                            ) : (
                                <form onSubmit={handleBulkSearch} className="relative bg-white rounded-2xl shadow-xl p-2 ring-1 ring-slate-900/5">
                                    <textarea className="w-full px-4 py-4 bg-transparent text-base outline-none placeholder:text-slate-300 text-slate-700 font-medium min-h-[150px]" placeholder={"0101...\nMaria..."} value={bulkQuery} onChange={(e) => setBulkQuery(e.target.value)}></textarea>
                                    <div className="flex justify-end p-2"><button type="submit" disabled={loading} className="bg-blue-600 text-white px-6 py-2.5 rounded-xl hover:bg-blue-700 shadow-md font-medium flex items-center gap-2">{loading ? <Loader2 className="animate-spin" size={18} /> : <List size={18} />} Procesar</button></div>
                                </form>
                            )}
                        </div>

                        <div className="w-full max-w-2xl">
                            {searchMode === 'single' && hasSearched && result && (
                                <div className="bg-white rounded-3xl shadow-xl overflow-hidden animate-in slide-in-from-bottom-4">
                                    <div className="bg-green-600 p-4 text-white flex gap-3 items-center"><CheckCircle2 size={24}/><div><h3 className="font-bold">Encontrado</h3></div></div>
                                    <div className="p-6">
                                        <h4 className="text-2xl font-bold text-slate-800 mb-4">{result.nombre}</h4>
                                        <div className="grid grid-cols-2 gap-4">
                                            <div className="bg-slate-50 p-4 rounded-xl"><div className="flex items-center gap-2 text-blue-600 mb-1"><CreditCard size={14}/><span className="text-xs font-bold">ID</span></div><p className="font-mono">{result.id}</p></div>
                                            <div className="bg-slate-50 p-4 rounded-xl"><div className="flex items-center gap-2 text-blue-600 mb-1"><MapPin size={14}/><span className="text-xs font-bold">LUGAR</span></div><p className="text-sm">{result.aldea}</p></div>
                                        </div>
                                    </div>
                                </div>
                            )}
                            {searchMode === 'single' && hasSearched && !result && !loading && (
                                <div className="bg-white rounded-3xl shadow-xl p-8 text-center animate-in"><div className="bg-red-50 w-16 h-16 rounded-full flex items-center justify-center mx-auto mb-4"><UserX className="text-red-500" size={32}/></div><h3 className="text-xl font-bold text-slate-800">No encontrado</h3></div>
                            )}
                            {searchMode === 'bulk' && bulkResults && (
                                <div className="space-y-6 animate-in slide-in-from-bottom-4">
                                    {bulkResults.found.length > 0 && (
                                        <div className="bg-white p-4 rounded-2xl shadow-sm border border-green-100">
                                            <h3 className="text-green-700 font-bold mb-3 flex items-center gap-2"><CheckCircle2 size={18}/> Encontrados ({bulkResults.found.length})</h3>
                                            <div className="space-y-2">{bulkResults.found.map((r,i) => <div key={i} className="text-sm border-b border-slate-50 pb-2 last:border-0"><span className="font-bold text-slate-700">{r.data.nombre}</span> <span className="text-slate-400 text-xs ml-2">{r.data.id}</span></div>)}</div>
                                        </div>
                                    )}
                                    {bulkResults.notFound.length > 0 && (
                                        <div className="bg-white p-4 rounded-2xl shadow-sm border border-red-100">
                                            <h3 className="text-red-700 font-bold mb-3 flex items-center gap-2"><UserX size={18}/> No Encontrados ({bulkResults.notFound.length})</h3>
                                            <div className="text-sm text-red-600 space-y-1">{bulkResults.notFound.map((r,i)=><div key={i}>{r}</div>)}</div>
                                        </div>
                                    )}
                                </div>
                            )}
                        </div>
                    </main>
                </div>
            );
        }

        const root = ReactDOM.createRoot(document.getElementById('root'));
        root.render(<App />);
    </script>
</body>
</html>
